<!DOCTYPE html>
<html>
  <head>
    <title>Centrifuge Test</title>
    <script src="https://unpkg.com/centrifuge@5.0.0/dist/centrifuge.js"></script>
  </head>
  <body>
    <h1>Centrifuge Test</h1>
    <div>Try use curl to send a message to test</div>
    <pre>
  curl -X 'POST' \
  'http://localhost:8003/api/v1/test-socket/broadcast' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{"message": "Hello world!"}'
    </pre>
    <div id="messages"></div>

    <script>
      // Use WebSocket transport endpoint.
      const centrifuge = new Centrifuge("ws://localhost:8098/ws/connect");

      // Allocate Subscription to a channel.
      const sub = centrifuge.newSubscription("broadcast");

      // React on `news` channel real-time publications.
      sub.on("publication", function (ctx) {
        var messageElement = document.createElement("div");
        messageElement.textContent = ctx.data;
        document.getElementById("messages").appendChild(messageElement);
      });

      // Add connection event handlers
      centrifuge.on("connected", function (ctx) {
        console.log("Connected to Centrifuge server");
      });

      centrifuge.on("disconnected", function (ctx) {
        console.log("Disconnected:", ctx.reason);
      });

      centrifuge.on("error", function (ctx) {
        console.log("Error:", ctx.error);
      });

      // Trigger subscribe process.
      sub.subscribe();

      // Trigger actual connection establishement.
      centrifuge.connect();
    </script>
  </body>
</html>
